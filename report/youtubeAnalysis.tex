% !TEX encoding = UTF-8 Unicode

\documentclass[a4paper]{article}


\usepackage{color}
\usepackage{url}
\usepackage{amsthm}
\usepackage[T2A]{fontenc} % enable Cyrillic fonts
\usepackage[utf8]{inputenc} % make weird characters work
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{amsmath}
\usepackage{verbatim}
\graphicspath{ {./images/} }

\usepackage[english,serbian]{babel}

\usepackage[unicode]{hyperref}


%================= start config for code printing
\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=Java,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=4
}

%============ end code

\hypersetup{colorlinks,citecolor=green,filecolor=green,linkcolor=blue,urlcolor=blue}

\newtheorem*{tvrdjenje}{Tvrđenje}
\newtheorem*{hipoteza}{Hipoteza}
\theoremstyle{definition}
\newtheorem{primer}{Primer}[section]



\begin{document}

\title{YouTube Trending\\ \small{Seminarski rad u okviru kursa\\Istraživanje podataka\\ Matematički fakultet}}

\author{Nikola Dimitrijević \footnote{mi14079@alas.matf.bg.ac.rs}\\
        Luka Živanović \footnote{mi14164@alas.matf.bg.ac.rs}\\
 }
%\date{9.~april 2015.}
\vspace*{-3cm}
    {\let\newpage\relax\maketitle}

\tableofcontents

\newpage



% ==============================================================================
\section{Uvod}
\label{sec:uvod}
% ==============================================================================
Skup podataka ``Trending YouTube Video Statistics'' sadrži informacije o YouTube video klipovima koji su se pojavili na Trending listi.
Klipovi koji se nalaze na Trendingu su u tom trenutku aktuelni, popularni ili relevantni. Neće svaki klip sa mnogo pregleda biti na trendingu,
 pritom se trending liste razlikuju za svaku državu. Podaci su nastali višemesečnim prikupljanjem klipova sa trending liste korišćenjem YouTube API.
Skup podataka se može naći na adresi \url{https://www.kaggle.com/datasnaek/youtube-new}.
Za obradu tokom ovog projekta su korišćeni KNIME platforma i Java programski jezik.

% ==============================================================================
\section{Analiza i pretprocesiranje podataka}


\label{sec:analiza}
% ==============================================================================

\subsection{Opis skupa podataka}
Podaci se nalaze u više tabela: US, GB, DE,
CA i FR (SAD, Velika Britanija, Nemačka, Kanada i Francuska redom). 
Svaki klip se može naći više puta na trendingu.
Primera radi, US tabela sadrži 38549 redova, među kojima je zapravo  6201 različitih klipova.


\begin{table}[h!]
\centering
\begin{tabular}{ |c|c| } 
 \hline
 video\_id & jedinstveni identifikator svakog video klipa  \\ 
\hline
 trending\_date & datum kad je klip bio na trendingu (yy.dd.mm)  \\ 
\hline
 title & naziv klipa  \\ 
\hline
 channel\_title & naziv kanala koji je postavio klip  \\ 
\hline
 category\_id & jedinstveni identifikator tematske kategorije klipa  \\ 
\hline
publish\_time & vreme postavljanja klipa (yyyy-mm-ddThh:mm:ss.000Z)\\ 
\hline
tags & ključne reči, u formatu tag1|tag2|... |tagn  \\ 
\hline
views & broj pregleda  \\ 
\hline
likes & broj ljudi koji su izabrali da im se sviđa klip\\ 
\hline
dislikes & broj ljudi koji su izabrali da im se ne sviđa klip   \\ 
\hline
comment\_count & broj komentara \\ 
\hline
thumbnail\_link & link ka sličici koja predstavlja video klip  \\ 
\hline
comments\_disabled & da li su komentari isključeni  \\ 
\hline
ratings\_disabled & da li je ocenjivanje isključeno \\ 
\hline
video\_error\_or\_removed & da li video ima grešku ili je uklonjen  \\ 
\hline
description & opis video klipa  \\ 
 \hline
\end{tabular}
\caption{Opis datoteke USvideos.csv. Nazivi kolona su dati levo, a njihovi opisi desno.}
\label{table:1}
\end{table}

Ovaj skup podataka takođe sadrži i JSON datoteke za svaku od navedenih država.
Razlog za to je što se skup tematskih kategorija klipova razlikovao među državama, pa se u JSON datotekama nalaze imena koja odgovaraju određenim identifikatorima kategorija.

\subsection{Pretprocesiranje}

\begin{figure}[h!]
\begin{center}
    \includegraphics[width=1\textwidth]{Global.png}
    \caption{Globalni pogled na KNIME projekat}
\end{center}
\end{figure}

U donjem levom delu se učitavaju podaci iz .csv datoteka, pretprocesiraju, prečišćavaju, dodaje se redovima oznaka na koju državu se odnose.
Nakon toga se svi spajaju u jednu ogrmonu tabelu.

Preprocessing meta-čvor sadrži obrade koje su potrebne za sav dalji tok analize.


\begin{figure}[h!]
\begin{center}
    \includegraphics[width=1\textwidth]{preprocessing.png}
    \caption{Pretprocesiranje}
\end{center}
\end{figure}
Prvo se uklanja kolona sa linkom na sliku pošto se to neće koristiti. Potom se konvertuju stringovski zapisi datuma u datumske tipove. 
Za svaki video\_id se broji koliko puta se pojavljuje u toj tabeli, pa se potom spajaju kako bi se na sve redove nadovezao taj atribut.
Takođe se izdvaja i lista svih datuma kad je taj klip bio na trendingu.
Za neke operacije nije bilo dovoljno koristiti ugrađene operacije preko običnih KNIME  čvorova, pa se tada koristi ``Java snippet''.

\begin{lstlisting}
// racunanje broja dana koliko je ova instanca bila na trendingu, i da li ce biti jos barem jednom
public void snippet() throws TypeException, ColumnException, Abort {

	// datum trendinga ove instance
	LocalDate l = c_trending_date;
	// lista svih datuma kada je ovaj video_id bio na trendingu
	LocalDate list[] = c_Sortedlisttrending_date;

	int c = 0;
	// brojanje koliko instanci je bilo na trendingu pre ove instance
	for (LocalDate e : c_Sortedlisttrending_date){	
		if (l.compareTo(e) >= 0 ){
			c++;
		}
	}
	out_days_trending = c;
	// ako je ova instanca ima najnoviji datum medju svim u listi
	// onda nece biti na trendingu jos jednom
	out_WillTrendAgain = c < list.length ? "true" : "false";

}

\end{lstlisting}


Takođe je pravljen novi atribut koji govori o broju dana između postavljanja klipa na YouTube i dana kada je na trendingu.
Sledeći Java snippet to obrađuje.

\begin{lstlisting}
import java.time.temporal.*;
// system variables
public class JSnippet extends AbstractJSnippet {
// Fields for input columns
/** Input column: "trending_date" */
public LocalDate c_trending_date;
/** Input column: "publish_time" */
public ZonedDateTime c_publish_time;

// Fields for output columns
/** Output column: "days_after_publish" */
public Integer out_days_after_publish;

public void snippet() throws TypeException, ColumnException, Abort {

	long daysBetween = ChronoUnit.DAYS.
		between(c_publish_time.toLocalDate(), c_trending_date);

	out_days_after_publish = (int)daysBetween;	
}
\end{lstlisting}

Potom se računa broj tagova, korišćenjem kratkog izraza unutar String Manipulation čvora.

\begin{verbatim}
count($tags$, "|") + compare($tags$, "")
\end{verbatim}

I na kraju se računa više novih atributa korišćenjem sledećeg Java koda.

Cilj je izračunati neke interesantne atribute analizom teksta naziva klipa kao i njegovog opisa.


\begin{lstlisting}
// broj reci u naslovu
out_title_word_count = 0;

// broj reci u naslovu koje pocinju velikim slovom
out_title_capital_percentage = 0.;

// broj reci koje su u potpunosti napisane velikim slovima
out_title_upper_case_percentage = 0.;

// broj reci u opisu klipa
out_description_word_count = 0;

// broj reci u opisu koje pocinju velikim slovom
out_description_capital_percentage = 0.;

// broj reci u opisu koje su u potpunosti napisane velikim slovima
out_description_upper_case_percentage = 0.;

int title_capital_count = 0;
int title_upper_count = 0;
int description_capital_count = 0;
int description_upper_count = 0;

// izdvajaju se grupe karaktera koje su sacinjene 1+ slova
String[] title_words = c_title.split("\\W+");
for (int i=0; i<title_words.length; i++) {
	out_title_word_count++;
	String word = title_words[i];
	int n = word.length();
	boolean isUpper = true;
	boolean isCapital = true;
	for (int j=0; j<n; j++) {
		if (j==0 && word.charAt(j)!=Character.toUpperCase(word.charAt(j))) {
			isUpper = false;
			isCapital = false;
			break;
		} else if (j!=0) {
			if (word.charAt(j)==Character.toUpperCase(word.charAt(j))) {
				isCapital = false;
			}
			else {
				isUpper = false;
			}
		}
	}
	if (isUpper)
		title_upper_count++;
	if (isCapital)
		title_capital_count++;
}

// izdvajaju se grupe karaktera koje su sacinjene 1+ slova
String[] desc_words = c_description.split("\\W+");
for (int i=0; i<desc_words.length; i++) {
	out_description_word_count++;
	String word = desc_words[i];
	int n = word.length();
	boolean isUpper = true;
	boolean isCapital = true;
	for (int j=0; j<n; j++) {
		if (j==0 && word.charAt(j)!=Character.toUpperCase(word.charAt(j))) {
			isUpper = false;
			isCapital = false;
			break;
		} else if (j!=0) {
			if (word.charAt(j)==Character.toUpperCase(word.charAt(j))) {
				isCapital = false;
			}
			else {
				isUpper = false;
			}
		}
	}
	if (isUpper)
		description_upper_count++;
	if (isCapital)
		description_capital_count++;
}

// ako nije bilo nijedne utf-8 reci u naslovu
if (out_title_word_count == 0){
	out_title_capital_percentage = 0.0;
	out_title_upper_case_percentage = 0.0;
} else {
	out_title_capital_percentage = title_capital_count*1.0/out_title_word_count;
	out_title_upper_case_percentage = title_upper_count*1.0/out_title_word_count;
	
}

// ako nije bilo nijedne utf-8 reci u opisu
if (out_description_word_count == 0){
	out_description_capital_percentage = 0.0;
	out_description_upper_case_percentage = 0.0;
} else {
	out_description_capital_percentage = description_capital_count*1.0/out_description_word_count;
	out_description_upper_case_percentage = description_upper_count*1.0/out_description_word_count;
}


\end{lstlisting}


Meta-čvor za čiščenje sadrži sledeće.

\begin{figure}[h!]
\begin{center}
    \includegraphics[width=1\textwidth]{cleaning.png}
    \caption{Filtriranje sada nepotrebnih kolona}

\end{center}
\end{figure}

Row filter otklanja 7 neodgovarajućih redova, dok poslednji čvor konvertuje celobrojni zapis identifikatora kategorije u
stringovski, kako bi se posmatrao kao kategorički atribut.

Nakon pretprocesiranja i čišćenja svih csv datoteka potrebno ih je spojiti u jednu veliku tabelu. To se dešava unutar concatenate meta-čvora.

\begin{figure}[h!]
\begin{center}
    \includegraphics[width=1\textwidth]{concatenation.png}
    \caption{Sadržaj concatenate meta-čvora i detalji grupisanja}
    \label{fig:concat}
\end{center}
\end{figure}

Na kraju su video klipovi grupisani tako da se jedan video\_id nalazi samo u jednom redu, detalji grupisanja su prikazani na slici \ref{fig:concat}.


% ==============================================================================
\section{Klasifikacija}
\label{sec:klasifikacija}
% ==============================================================================
....
% ==============================================================================
\section{Pravila pridruživanja}
\label{sec:pravila}
% ==============================================================================

x <= {y, z}

% ==============================================================================
\section{One vizualizacije mozda ovde?}
\label{sec:dod}
% ==============================================================================

\end{document}

